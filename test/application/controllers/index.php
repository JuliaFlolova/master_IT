<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Index extends CI_Controller {	function __construct()	{        parent::__construct();    	//Подключаем модели        $this->load->model('emails_model');		//Подключаем библиотеки		$this->load->library('display');    }	    //Список всех отправленных писем	public function index()	{		$data = array();	    $data['all_emails']=$this->emails_model->get_all();		$name='index';		$this->display->display_page($name,$data);	}	   //Отрисовка формы письма	public function send()	{	    $name='add_form';		$this->display->display_page($name,NULL);    }		//Отправка письма по Ajax	public function send_ajax()	{		if($this->input->server('HTTP_X_REQUESTED_WITH') != 'XMLHttpRequest'){				die("Не Ajax!");         } else {		        //устанавливаем правила валидации				$this->form_validation->set_rules($this->emails_model->rules);						        //Проверяем заполняемы поля формы на валидность. Прваила валидации в config/form_validation.php				if($this->form_validation->run() ==FALSE) {				   //Если поля заполнены не верно, выводим сообщение об ошибке                  						echo validation_errors('<div class="alert alert-error">','</div>');				  				} else {				   //Если поля заполнены верно, то:				   //1) отправляем письмо на указанный адрес				   	$this->email->from('testitmaster2014@gmail.com','Name');//от кого					$this->email->to($this->input->post('email')); 		 //e-mail получателя					$this->email->subject($this->input->post('theme'));   //тема письма					$this->email->message($this->input->post('text'));	 //содержимое письма 					$this->email->send(); //отправить письмо                   				   //2) заносим данные в БД					$this->emails_model->add();									   //3) выводим сообщение об успешной отправке письма				   	echo '<div class="alert alert-success"> Ваше письмо успешно отправлено! </div>';									}   			}	   		} //End function send_ajax			//Просмотр выбранного письма			public function read($id)	{	    $data['show_mail']=$this->emails_model->read($id);//данные по записи с $id  	    $name='read_form';//имя шаблона		$this->display->display_page($name,$data);//вывод данных в шаблон    }//End function read			//Удаление выбранных писем		public function delete()	{	        if  (isset($_POST['chk'])) { //если отмечен чекбокс						//удаляем письма, отмеченные чекбоксом 						foreach($_POST['chk'] as $ch) 						{ 							$this->emails_model->delete($ch); 													} 					} 			 redirect('index/index');						} //End function delete	}//End class Index/* End of file index.php *//* Location: ./application/controllers/index.php */